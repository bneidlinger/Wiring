<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Export Test - Wiring Diagram</title>
    <style>
        body {
            margin: 20px;
            font-family: Arial, sans-serif;
        }
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        .test-section h2 {
            margin-top: 0;
        }
        .test-btn {
            padding: 10px 20px;
            margin: 5px;
            background: #3498db;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        .test-btn:hover {
            background: #2980b9;
        }
        #test-svg {
            border: 1px solid #ccc;
            margin: 20px 0;
        }
        .log {
            margin-top: 20px;
            padding: 10px;
            background: #f0f0f0;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <h1>Export Functionality Test</h1>
    
    <div class="test-section">
        <h2>Test SVG</h2>
        <svg id="test-svg" width="400" height="300" xmlns="http://www.w3.org/2000/svg">
            <rect x="10" y="10" width="100" height="80" fill="#3498db" stroke="#2c3e50" stroke-width="2"/>
            <circle cx="200" cy="100" r="40" fill="#e74c3c" stroke="#c0392b" stroke-width="2"/>
            <text x="50" y="150" font-family="Arial" font-size="16" fill="#333">Test Diagram</text>
            <line x1="10" y1="200" x2="390" y2="200" stroke="#333" stroke-width="1" stroke-dasharray="5,5"/>
            <path d="M 300 50 L 350 100 L 300 150 Z" fill="#2ecc71" stroke="#27ae60" stroke-width="2"/>
        </svg>
    </div>
    
    <div class="test-section">
        <h2>Export Tests</h2>
        <button class="test-btn" onclick="testSVGExport()">Test SVG Export</button>
        <button class="test-btn" onclick="testPNGExport()">Test PNG Export</button>
        <button class="test-btn" onclick="testPDFExport()">Test PDF Export</button>
        <button class="test-btn" onclick="testBatchExport()">Test Batch Export</button>
        <button class="test-btn" onclick="testHighResExport()">Test High-Res PNG</button>
        <button class="test-btn" onclick="testPrintPDF()">Test Print PDF</button>
    </div>
    
    <div class="test-section">
        <h2>Test Log</h2>
        <div id="log" class="log"></div>
    </div>
    
    <script type="module">
        import { SVGExporter } from './src/export/SVGExporter.js';
        import { PNGExporter } from './src/export/PNGExporter.js';
        import { PDFExporter } from './src/export/PDFExporter.js';
        import { ProgressIndicator } from './src/export/ProgressIndicator.js';
        
        window.log = function(message) {
            const logDiv = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            logDiv.innerHTML += `[${timestamp}] ${message}<br>`;
            logDiv.scrollTop = logDiv.scrollHeight;
        };
        
        window.testSVGExport = async function() {
            try {
                log('Starting SVG export test...');
                const svg = document.getElementById('test-svg');
                const exporter = new SVGExporter();
                
                const result = await exporter.export(svg, {
                    embedImages: true,
                    embedStyles: true,
                    optimizeForPrint: false,
                    projectName: 'test-diagram'
                });
                
                log(`SVG export successful: ${result.filename}`);
                
                // Download the file
                const link = document.createElement('a');
                link.href = URL.createObjectURL(result.blob);
                link.download = result.filename;
                link.click();
                
            } catch (error) {
                log(`SVG export failed: ${error.message}`);
            }
        };
        
        window.testPNGExport = async function() {
            try {
                log('Starting PNG export test...');
                const svg = document.getElementById('test-svg');
                const exporter = new PNGExporter();
                
                const result = await exporter.export(svg, {
                    width: 800,
                    height: 600,
                    dpi: 150,
                    quality: 0.9,
                    backgroundColor: '#ffffff',
                    transparent: false,
                    projectName: 'test-diagram'
                });
                
                log(`PNG export successful: ${result.filename} (${result.dimensions.width}x${result.dimensions.height})`);
                
                // Download the file
                const link = document.createElement('a');
                link.href = URL.createObjectURL(result.blob);
                link.download = result.filename;
                link.click();
                
            } catch (error) {
                log(`PNG export failed: ${error.message}`);
            }
        };
        
        window.testPDFExport = async function() {
            try {
                log('Starting PDF export test...');
                const svg = document.getElementById('test-svg');
                const exporter = new PDFExporter();
                
                const result = await exporter.export(svg, {
                    orientation: 'landscape',
                    format: 'letter',
                    margins: { top: 20, right: 20, bottom: 20, left: 20 },
                    autoFit: true,
                    blackAndWhite: false,
                    includeMetadata: true,
                    projectName: 'test-diagram',
                    metadata: {
                        author: 'Test User',
                        created: new Date().toISOString(),
                        elementCount: 5,
                        wireCount: 1
                    }
                });
                
                log(`PDF export successful: ${result.filename} (${result.pages} pages)`);
                
                // Download the file
                const link = document.createElement('a');
                link.href = URL.createObjectURL(result.blob);
                link.download = result.filename;
                link.click();
                
            } catch (error) {
                log(`PDF export failed: ${error.message}`);
            }
        };
        
        window.testBatchExport = async function() {
            try {
                log('Starting batch export test...');
                const svg = document.getElementById('test-svg');
                
                const progress = new ProgressIndicator();
                progress.show('Preparing batch export...');
                
                // Export all formats
                const svgExporter = new SVGExporter();
                const pngExporter = new PNGExporter();
                const pdfExporter = new PDFExporter();
                
                progress.update('Exporting SVG...', 0);
                const svgResult = await svgExporter.export(svg, { projectName: 'batch-test' });
                
                progress.update('Exporting PNG...', 33);
                const pngResult = await pngExporter.export(svg, {
                    width: 1200,
                    height: 900,
                    dpi: 300,
                    projectName: 'batch-test'
                });
                
                progress.update('Exporting PDF...', 66);
                const pdfResult = await pdfExporter.export(svg, {
                    format: 'a4',
                    projectName: 'batch-test'
                });
                
                progress.complete('Batch export completed!');
                
                log('Batch export successful - downloading files...');
                
                // Download all files
                [svgResult, pngResult, pdfResult].forEach((result, index) => {
                    setTimeout(() => {
                        const link = document.createElement('a');
                        link.href = URL.createObjectURL(result.blob);
                        link.download = result.filename;
                        link.click();
                    }, index * 200);
                });
                
            } catch (error) {
                log(`Batch export failed: ${error.message}`);
            }
        };
        
        window.testHighResExport = async function() {
            try {
                log('Starting high-resolution PNG export test...');
                const svg = document.getElementById('test-svg');
                const exporter = new PNGExporter();
                
                const progress = new ProgressIndicator();
                progress.show('Exporting high-resolution PNG...');
                
                const result = await exporter.export(svg, {
                    width: 4000,
                    height: 3000,
                    dpi: 600,
                    quality: 1.0,
                    backgroundColor: '#ffffff',
                    transparent: false,
                    projectName: 'high-res-test'
                });
                
                progress.complete();
                
                log(`High-res PNG export successful: ${result.filename} (${result.dpi} DPI)`);
                
                // Download the file
                const link = document.createElement('a');
                link.href = URL.createObjectURL(result.blob);
                link.download = result.filename;
                link.click();
                
            } catch (error) {
                log(`High-res PNG export failed: ${error.message}`);
            }
        };
        
        window.testPrintPDF = async function() {
            try {
                log('Starting print-optimized PDF export test...');
                const svg = document.getElementById('test-svg');
                const exporter = new PDFExporter();
                
                const result = await exporter.export(svg, {
                    orientation: 'portrait',
                    format: 'a4',
                    margins: { top: 25, right: 25, bottom: 25, left: 25 },
                    autoFit: true,
                    blackAndWhite: true,
                    includeMetadata: true,
                    projectName: 'print-test',
                    metadata: {
                        title: 'Print Test Diagram',
                        author: 'Test User'
                    }
                });
                
                log(`Print PDF export successful: ${result.filename}`);
                
                // Download the file
                const link = document.createElement('a');
                link.href = URL.createObjectURL(result.blob);
                link.download = result.filename;
                link.click();
                
            } catch (error) {
                log(`Print PDF export failed: ${error.message}`);
            }
        };
        
        // Initial log
        log('Export test page loaded. Click buttons to test export functionality.');
    </script>
</body>
</html>