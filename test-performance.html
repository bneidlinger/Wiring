<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Canvas Performance Test</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: Arial, sans-serif;
        }
        #controls {
            margin-bottom: 20px;
            padding: 20px;
            background: #f0f0f0;
            border-radius: 8px;
        }
        button {
            padding: 10px 20px;
            margin: 5px;
            border: none;
            background: #3498db;
            color: white;
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover {
            background: #2980b9;
        }
        #stats {
            display: inline-block;
            margin-left: 20px;
            font-weight: bold;
        }
        .info {
            margin: 10px 0;
            padding: 10px;
            background: #e8f4f8;
            border-left: 4px solid #3498db;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <div id="controls">
        <h2>SVG Canvas Performance Test</h2>
        <div class="info">
            This test demonstrates the viewport culling and LOD optimizations.
            Use the buttons below to add many elements and observe the performance monitor.
        </div>
        <button onclick="addRandomComponents(100)">Add 100 Components</button>
        <button onclick="addRandomComponents(500)">Add 500 Components</button>
        <button onclick="addRandomComponents(1000)">Add 1000 Components</button>
        <button onclick="addRandomWires(100)">Add 100 Wires</button>
        <button onclick="addRandomWires(500)">Add 500 Wires</button>
        <button onclick="clearCanvas()">Clear Canvas</button>
        <span id="stats">Total Elements: 0</span>
    </div>
    
    <iframe src="index.html" width="100%" height="800" frameborder="0"></iframe>
    
    <script>
        let iframe, app, totalElements = 0;
        
        // Wait for iframe to load
        window.onload = function() {
            iframe = document.querySelector('iframe');
            
            // Give the app time to initialize
            setTimeout(() => {
                app = iframe.contentWindow.wiringApp;
                if (!app) {
                    console.error('App not initialized');
                }
            }, 1000);
        };
        
        function updateStats() {
            document.getElementById('stats').textContent = `Total Elements: ${totalElements}`;
        }
        
        function addRandomComponents(count) {
            if (!app) {
                alert('App not initialized yet. Please wait a moment and try again.');
                return;
            }
            
            const componentTypes = ['ACM', 'iSTAR', 'OUTPUT', 'READER', 'PSU', 'PAM'];
            
            for (let i = 0; i < count; i++) {
                const type = componentTypes[Math.floor(Math.random() * componentTypes.length)];
                const x = Math.random() * 10000;
                const y = Math.random() * 6000;
                
                // Create component using element factory
                const component = app.elementFactory.createComponent(type, x, y);
                app.canvas.addComponent(component);
            }
            
            totalElements += count;
            updateStats();
        }
        
        function addRandomWires(count) {
            if (!app) {
                alert('App not initialized yet. Please wait a moment and try again.');
                return;
            }
            
            const colors = ['#FF0000', '#000000', '#00FF00', '#FFFFFF', '#0000FF'];
            const svgNS = 'http://www.w3.org/2000/svg';
            
            for (let i = 0; i < count; i++) {
                const wire = iframe.contentDocument.createElementNS(svgNS, 'path');
                
                // Random path
                const x1 = Math.random() * 10000;
                const y1 = Math.random() * 6000;
                const x2 = x1 + (Math.random() - 0.5) * 1000;
                const y2 = y1 + (Math.random() - 0.5) * 1000;
                
                wire.setAttribute('d', `M ${x1} ${y1} L ${x2} ${y2}`);
                wire.setAttribute('stroke', colors[Math.floor(Math.random() * colors.length)]);
                wire.setAttribute('stroke-width', '3');
                wire.setAttribute('fill', 'none');
                wire.classList.add('wire');
                
                app.canvas.addWire(wire);
            }
            
            totalElements += count;
            updateStats();
        }
        
        function clearCanvas() {
            if (!app) {
                alert('App not initialized yet. Please wait a moment and try again.');
                return;
            }
            
            app.canvas.clear();
            totalElements = 0;
            updateStats();
        }
    </script>
</body>
</html>